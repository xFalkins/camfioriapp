// Monkey-patched cds.ql implementations from cds-runtime
module.exports = Object.assign (_deprecated_srv_ql, require('../../../libx/_runtime').statements, {
  Query:  require('./Query'),
  SELECT: require('./SELECT')._api(),
  INSERT: require('./INSERT')._api(),
  UPDATE: require('./UPDATE')._api(),
  DELETE: require('./DELETE')._api(),
})


function _deprecated_srv_ql() {
  // eslint-disable-next-line no-console
  console.trace(`
    Method 'srv.ql(req)' is deprecated and superceded by 'cds.context'.
    Please use global SELECT instead of 'const { SELECT } = srv.ql(req)'.
  `)
  return module.exports
}


const {cds} = global
if (cds.env.features.cls && cds.env.features.debug_queries) {
  const { AsyncResource } = require('async_hooks')
  const { Query } = module.exports
  const { then } = Query.prototype
  Object.defineProperty (Query,'then',{
    get(){
      const q = new AsyncResource('cds.Query')
      return (r,e) => q.runInAsyncScope (then,this,r,e)
    }
  })
}
